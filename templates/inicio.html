{% extends 'base.html' %}

{% block title %}Inicio - MuseoQR{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="hero">
        <h1> {{ museo.nombre | default:"Bienvenido al Museo" }}</h1>
        <p class="lead">Inicia una emocionante b煤squeda del tesoro con c贸digos QR</p>
    </div>

    {% if user.is_authenticated %}
        <!-- Usuario autenticado -->
        <div class="row mb-4">
            <div class="col-md-8 mx-auto">
                <div class="card content-box">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h3>隆Bienvenido de vuelta, {{ user.first_name | default:user.username }}!</h3>
                            <p class="text-muted">Contin煤a tu aventura en el museo</p>
                            
                            {% if usuario_museo %}
                                <div class="mb-3">
                                    <p><strong>Nivel:</strong> <span class="badge bg-success">{{ usuario_museo.nivel }}</span></p>
                                    <p><strong>Puntos:</strong> {{ usuario_museo.puntos }} </p>
                                    <p><strong>QR escaneados:</strong> {{ usuario_museo.total_qrs_escaneados }}/{{ total_qrs }}</p>
                                </div>
                                
                                {% if total_qrs > 0 %}
                                    <div class="progress" style="height: 25px;">
                                        <div class="progress-bar" role="progressbar" 
                                             style="width: {{ porcentaje_completado }}%">
                                            {{ porcentaje_completado }}% Completado
                                        </div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                        <div class="col-md-4 text-center">
                            <img src="{% if usuario_museo.avatar %}{{ usuario_museo.avatar.url }}{% else %}https://via.placeholder.com/100{% endif %}" 
                                 alt="Avatar" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Acciones principales -->
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card content-box h-100 text-center">
                    <i class="fas fa-camera text-primary" style="font-size: 3rem; margin: 1rem 0;"></i>
                    <h4>Escanear C贸digo QR</h4>
                    <p class="text-muted">Escanea c贸digos QR para descubrir contenido del museo</p>
                    <a href="{% url 'escanear_qr' %}" class="btn btn-primary">Comenzar a Escanear</a>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card content-box h-100 text-center">
                    <i class="fas fa-chart-line text-success" style="font-size: 3rem; margin: 1rem 0;"></i>
                    <h4>Ver Mi Progreso</h4>
                    <p class="text-muted">Revisa tu progreso y tus comentarios</p>
                    <a href="{% url 'mi_progreso' %}" class="btn btn-success">Mi Progreso</a>
                </div>
            </div>
        </div>

        {% if user.is_staff %}
            <!-- Secci贸n Admin -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card content-box">
                        <h5 class="card-title">
                            <i class="fas fa-tachometer-alt"></i> Panel de Administraci贸n
                        </h5>
                        <p class="text-muted">Acceso r谩pido a funciones administrativas</p>
                        <a href="{% url 'admin_dashboard' %}" class="btn btn-warning">
                            <i class="fas fa-sliders-h"></i> Ir al Dashboard
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}

    {% else %}
        <!-- Usuario no autenticado -->
        <div class="row">
            <div class="col-md-8 mx-auto mb-5">
                <div class="card content-box">
                    <div class="text-center">
                        <h2>隆Comienza tu Aventura!</h2>
                        <p class="lead text-muted">Explora el museo escaneando c贸digos QR y descubre contenido fascinante</p>
                        <p class="text-muted mb-4">El registro es opcional pero te permite guardar tu progreso</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card content-box h-100 text-center">
                    <i class="fas fa-lock-open text-info" style="font-size: 3rem; margin: 1rem 0;"></i>
                    <h4>Acceso R谩pido</h4>
                    <p class="text-muted">Escanea QR sin crear cuenta</p>
                    <a href="{% url 'escanear_qr' %}" class="btn btn-info mb-2" onclick="
                        if(!confirm('Necesitas iniciar sesi贸n para escanear. 驴Deseas hacerlo?')) return false;">
                        Probar Ahora
                    </a>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card content-box h-100 text-center">
                    <i class="fas fa-user-plus text-success" style="font-size: 3rem; margin: 1rem 0;"></i>
                    <h4>Crear Cuenta</h4>
                    <p class="text-muted">Guarda tu progreso y comentarios</p>
                    <a href="{% url 'registro' %}" class="btn btn-success mb-2">Registrarse</a>
                    <p class="small text-muted">驴Ya tienes cuenta? <a href="{% url 'login' %}">Inicia sesi贸n</a></p>
                </div>
            </div>
        </div>

        <!-- Informaci贸n del museo -->
        {% if museo.descripcion %}
            <div class="row mt-5">
                <div class="col-md-8 mx-auto">
                    <div class="card content-box">
                        {% if museo.imagen_logo %}
                            <div class="text-center mb-3">
                                <img src="{{ museo.imagen_logo.url }}" alt="Logo del museo" style="max-width: 150px; height: auto;">
                            </div>
                        {% endif %}
                        <h5> {{ museo.nombre }}</h5>
                        <p>{{ museo.descripcion }}</p>
                        {% if museo.ubicacion %}
                            <p class="text-muted"><i class="fas fa-map-marker-alt"></i> {{ museo.ubicacion }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endif %}
    {% endif %}

    <!-- Info general -->
    <div class="row mt-5">
        <div class="col-md-12">
            <div class="alert alert-info" role="alert">
                <h6><i class="fas fa-info-circle"></i> Informaci贸n</h6>
                <p class="mb-0">Total de puntos de inter茅s: <strong>{{ total_qrs }}</strong></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
